"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const fs_extra_1 = require("fs-extra");
const path_1 = require("path");
const pubsub_1 = require("./pubsub");
const nconf = require.main.require('nconf');
const baseDir = nconf.get('base_dir');
// build when a plugin is (de)activated if that plugin is an emoji pack
const toggle = async ({ id }) => {
    let file;
    try {
        file = await fs_extra_1.readFile(path_1.join(baseDir, 'node_modules', id, 'plugin.json'), 'utf8');
    }
    catch (err) {
        if (err && err.code !== 'ENOENT') {
            throw err;
        }
        return;
    }
    const plugin = JSON.parse(file);
    const hasHook = plugin.hooks && plugin.hooks
        .some((hook) => hook.hook === 'filter:emoji.packs');
    if (hasHook) {
        await pubsub_1.build();
    }
};
exports.activation = toggle;
exports.deactivation = toggle;
//# sourceMappingURL=plugins.js.map